로컬 에이전트 - 웹 프론트엔드(Vercel) HTTPS 연결 가이드
본 문서는 Vercel에 배포된 HTTPS 웹 애플리케이션과 사용자 PC에서 실행 중인 HTTP/HTTPS 로컬 에이전트 간의 통신 문제를 해결하기 위한 단계별 가이드를 제공합니다.

1. 현재 상황 및 문제점 (Issue)
   현상: Vercel 배포 사이트는 https:// 보안 프로토콜을 사용하지만, 로컬 에이전트는 보통 http://127.0.0.1을 사용함.

원인: 브라우저의 Mixed Content(혼합 콘텐츠) 차단 정책으로 인해 보안 사이트에서 비보안(HTTP) 로컬 서비스로의 fetch 요청이 강제 차단됨.

2. 해결 전략 1: 무료 도메인 맵핑 및 브라우저 허용 (단기/개발용)
   가장 빠르게 기능을 확인해야 할 때 사용하는 방법입니다.

에이전트 주소 추상화:

직접적인 IP(127.0.0.1) 대신 sslip.io 같은 서비스를 사용하여 도메인 형태의 주소를 확보합니다.

예: http://127.0.0.1.sslip.io:8080

브라우저 보안 예외 설정:

Vercel 앱 접속 후, 주소창 왼쪽의 아이콘(자물쇠 또는 주의)을 클릭합니다.

[사이트 설정] -> [안전하지 않은 콘텐츠] -> **[허용]**으로 변경합니다.

이 설정은 해당 사용자(개발자)의 브라우저에서만 유효합니다.

3. 해결 전략 2: 로컬 도메인 연결 및 공인 SSL 적용 (중기/정석)
   사용자에게 보안 경고를 보여주지 않고 통신하는 가장 전문적인 방법입니다.

DNS 설정 (A Record):

본인 소유 도메인의 서브도메인을 로컬 IP로 연결합니다.

설정 예: agent.yourdomain.com → 127.0.0.1

공인 SSL 인증서 발급:

ZeroSSL 또는 Let's Encrypt를 통해 해당 도메인의 인증서를 발급받습니다.

이때 서버가 외부에 없으므로 **DNS 인증 방식(DNS-01 Challenge)**을 사용해야 합니다.

에이전트 적용:

발급받은 .crt와 .key 파일을 로컬 에이전트(Spring Boot 등)의 SSL 설정에 넣고 HTTPS(예: 8443 포트)를 활성화합니다.

결과:

https://your-app.vercel.app → https://agent.yourdomain.com:8443

보안 영역 간의 통신이므로 브라우저 차단이 발생하지 않습니다.

4. 해결 전략 3: Cloudflare Tunnel 활용 (장기/고도화)
   로컬 에이전트가 방화벽 뒤에 있거나 공유기 환경일 때 유용합니다.

Cloudflare Zero Trust 사용:

로컬 PC에 cloudflared 에이전트를 설치합니다.

특정 도메인을 내 로컬 포트와 터널로 연결합니다.

장점:

Cloudflare가 SSL 인증서 관리와 도메인 연결을 모두 대행합니다.

로컬 서비스가 외부로 안전하게 노출되므로 Vercel과의 통신이 매우 안정적입니다.

5. Next.js 개발 시 주의사항 (체크리스트)
   [ ] 환경 변수: 브라우저에서 읽어야 하므로 반드시 NEXT*PUBLIC* 접두사를 붙일 것.

[ ] 컴포넌트 분리: 로컬 통신 로직은 반드시 'use client' 컴포넌트 내부에서 호출할 것 (Vercel 서버는 로컬에 접속할 수 없음).

[ ] CORS 설정: 로컬 에이전트 서버 설정에서 Vercel의 배포 도메인을 AllowOrigin에 추가할 것.
